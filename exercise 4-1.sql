CREATE DATABASE college_db;

USE college_db;

CREATE TABLE STUDENT (
    USN VARCHAR(10) PRIMARY KEY,
    SNAME VARCHAR(25),
    ADDRESS VARCHAR(25),
    PHONE BIGINT,
    GENDER CHAR(1)
);

CREATE TABLE SEMSEC (
    SSID VARCHAR(5) PRIMARY KEY,
    SEM INTEGER,
    SEC CHAR(1)
);

CREATE TABLE CLASS (
    USN VARCHAR(10),
    SSID VARCHAR(5),
    PRIMARY KEY (USN, SSID),
    FOREIGN KEY (USN) REFERENCES STUDENT(USN),
    FOREIGN KEY (SSID) REFERENCES SEMSEC(SSID)
);

CREATE TABLE SUBJECT (
    SUBCODE VARCHAR(8) PRIMARY KEY,
    TITLE VARCHAR(20),
    SEM INTEGER,
    CREDITS INTEGER
);

CREATE TABLE IAMARKS (
    USN VARCHAR(10),
    SUBCODE VARCHAR(8),
    SSID VARCHAR(5),
    TEST1 INTEGER,
    TEST2 INTEGER,
    TEST3 INTEGER,
    FINALIA INTEGER,
    PRIMARY KEY (USN, SUBCODE, SSID),
    FOREIGN KEY (USN) REFERENCES STUDENT(USN),
    FOREIGN KEY (SUBCODE) REFERENCES SUBJECT(SUBCODE),
    FOREIGN KEY (SSID) REFERENCES SEMSEC(SSID)
);

INSERT INTO STUDENT (USN, SNAME, ADDRESS, PHONE, GENDER) VALUES
('1GA22AI101', 'Alice', '123 Main St', 9876543210, 'F'),
('1GA22AI102', 'Bob', '456 Elm St', 9876543211, 'M'),
('1GA22AI103', 'Charlie', '789 Oak St', 9876543212, 'M'),
('1GA22AI104', 'Diana', '321 Pine St', 9876543213, 'F'),
('1GA22AI105', 'Eva', '654 Maple St', 9876543214, 'F');

INSERT INTO SEMSEC (SSID, SEM, SEC) VALUES
('SSID1', 4, 'C'),
('SSID2', 4, 'A'),
('SSID3', 5, 'B'),
('SSID4', 5, 'D'),
('SSID5', 8, 'A'),
('SSID6', 8, 'B'),
('SSID7', 8, 'C');

INSERT INTO CLASS (USN, SSID) VALUES
('1GA22AI101', 'SSID1'),
('1GA22AI102', 'SSID2'),
('1GA22AI103', 'SSID3'),
('1GA22AI104', 'SSID4'),
('1GA22AI105', 'SSID5');

INSERT INTO SUBJECT (SUBCODE, TITLE, SEM, CREDITS) VALUES
('CS101', 'Computer Science', 4, 3),
('MA101', 'Mathematics', 4, 4), 
('CS102', 'Data Structures', 5, 3),
('MA102', 'Statistics', 5, 4),
('CS201', 'Algorithms', 8, 3),
('MA201', 'Advanced Mathematics', 8, 4);

INSERT INTO IAMARKS (USN, SUBCODE, SSID, TEST1, TEST2, TEST3, FINALIA) VALUES
('1GA22AI101', 'CS101', 'SSID1', 18, 20, 19, 20),
('1GA22AI101', 'MA101', 'SSID1', 15, 16, 14, 18),
('1GA22AI101', 'MA102', 'SSID1', 14, 14, 14, 18),
('1GA22AI101', 'CS102', 'SSID1', 08, 08, 08, 18),
('1GA22AI102', 'CS101', 'SSID2', 12, 14, 13, 15),
('1GA22AI103', 'CS102', 'SSID3', 17, 18, 19, 19),
('1GA22AI103', 'MA102', 'SSID3', 16, 17, 15, 16),
('1GA22AI104', 'CS201', 'SSID4', 14, 15, 13, 14),
('1GA22AI104', 'MA201', 'SSID4', 13, 14, 12, 13),
('1GA22AI105', 'CS201', 'SSID5', 19, 20, 18, 20),
('1GA22AI105', 'MA201', 'SSID5', 18, 17, 19, 20);

DESC STUDENT;
DESC SEMSEC;
DESC CLASS;
DESC SUBJECT;
DESC IAMARKS;

SELECT * FROM STUDENT;
SELECT * FROM SEMSEC;
SELECT * FROM CLASS;
SELECT * FROM SUBJECT;
SELECT * FROM IAMARKS;

-- Query 1: List all the student details studying in fourth semester ‘C’ section.
SELECT S.*, SS.SEM, SS.SEC
FROM STUDENT S
JOIN CLASS C ON S.USN = C.USN
JOIN SEMSEC SS ON SS.SSID = C.SSID
WHERE SS.SEM = 4 AND SS.SEC = 'C';

-- Query 2: Compute the total number of male and female students in each semester and in each section.
SELECT SS.SEM, SS.SEC, 
       SUM(CASE WHEN S.GENDER = 'M' THEN 1 ELSE 0 END) AS Male_Count,
       SUM(CASE WHEN S.GENDER = 'F' THEN 1 ELSE 0 END) AS Female_Count
FROM STUDENT S
JOIN CLASS C ON S.USN = C.USN
JOIN SEMSEC SS ON SS.SSID = C.SSID
GROUP BY SS.SEM, SS.SEC;

-- Query 3: Create a view of Test1 marks of student USN 1GA22AI101 in all subjects.
CREATE VIEW Test1_Marks AS
SELECT IAM.USN, IAM.SUBCODE, IAM.TEST1
FROM IAMARKS IAM
WHERE IAM.USN = '1GA22AI101';

SELECT *
FROM Test1_Marks;

-- Insert a new student record
INSERT INTO STUDENT (USN, SNAME, ADDRESS, PHONE, GENDER) VALUES
('1GA22AI106', 'Frank', '987 Cedar St', 9876543216, 'M');

-- Adding a class entry
INSERT INTO CLASS (USN, SSID) VALUES
('1GA22AI106', 'SSID6'); -- Ensuring the class entry exists

-- Now insert the IAMARKS record
INSERT INTO IAMARKS (USN, SUBCODE, SSID, TEST1, TEST2, TEST3, FINALIA) VALUES
('1GA22AI106', 'CS201', 'SSID6', 15, 16, 14, 14);

INSERT INTO IAMARKS (USN, SUBCODE, SSID, TEST1, TEST2, TEST3, FINALIA) VALUES
('1GA22AI106', 'MA201', 'SSID6', 08, 08, 08, 08); 

-- Query 4: Calculate the FinalIA (average of best two test marks) and update the corresponding table for all students.
SELECT S.USN, S.SNAME, 
       CASE 
           WHEN IAM.FINALIA BETWEEN 17 AND 20 THEN 'Outstanding'
           WHEN IAM.FINALIA BETWEEN 12 AND 16 THEN 'Average'
           WHEN IAM.FINALIA < 12 THEN 'Weak'
       END AS Category
FROM STUDENT S
JOIN CLASS C ON S.USN = C.USN
JOIN SEMSEC SS ON SS.SSID = C.SSID
JOIN IAMARKS IAM ON IAM.USN = S.USN AND IAM.SSID = SS.SSID
WHERE SS.SEM = 8 AND SS.SEC IN ('A', 'B', 'C');
